<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting started: Skeleton analysis with Skan &mdash; Skan 0.10.0rc2 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using Skan’s GUI" href="gui.html" />
    <link rel="prev" title="Installing Skan" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Skan
          </a>
              <div class="version">
                0.10.0rc2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Skan</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started: Skeleton analysis with Skan</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#extracting-a-skeleton-from-an-image">0. Extracting a skeleton from an image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#measuring-the-length-of-skeleton-branches">1. Measuring the length of skeleton branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comparing-different-skeletons">2. Comparing different skeletons</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">Using Skan’s GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="complete_analysis.html">Complete analysis with Skan</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing Skan</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/api.html">Skan API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes/index.html">Skan release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Skan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Getting started: Skeleton analysis with Skan</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/getting_started.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started-skeleton-analysis-with-skan">
<h1>Getting started: Skeleton analysis with Skan<a class="headerlink" href="#getting-started-skeleton-analysis-with-skan" title="Permalink to this headline">¶</a></h1>
<p>Skeleton analysis allows us to measure fine structure in samples. In
this case, we are going to measure the network formed by a protein
called <em>spectrin</em> inside the membrane of a red blood cell, either
infected by the malaria parasite <em>Plasmodium falciparum</em>, or uninfected.</p>
<section id="extracting-a-skeleton-from-an-image">
<h2>0. Extracting a skeleton from an image<a class="headerlink" href="#extracting-a-skeleton-from-an-image" title="Permalink to this headline">¶</a></h2>
<p>Skan’s primary purpose is to analyse skeletons. (It primarily mimics the
<a class="reference external" href="https://imagej.net/AnalyzeSkeleton">“Analyze Skeleton” Fiji
plugin</a>.) In this section, we
will run some simple preprocessing on our source images to extract a
skeleton, provided by Skan and
<a class="reference external" href="https://scikit-image.org">scikit-image</a>, but this is far from the
optimal way of extracting a skeleton from an image. Skip to section 1
for Skan’s primary functionality.</p>
<p>First, we load the images. These images were produced by an FEI scanning
electron microscope. <a class="reference external" href="https://imageio.github.io">ImageIO</a> provides a
method to read these images, including metadata.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">imageio</span> <span class="k">as</span> <span class="nn">iio</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;example-data/*.tif&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image0</span> <span class="o">=</span> <span class="n">iio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;fei&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We display the images with <a class="reference external" href="http://matplotlib.org">Matplotlib</a>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If running in the IPython console, consider running <code class="docutils literal notranslate"><span class="pre">%matplotlib</span></code> to enable
interactive plots.  If running in the Jupyter Notebook, use <code class="docutils literal notranslate"><span class="pre">%matplotlib</span>
<span class="pre">inline</span></code>.</p>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-2.png">png</a>, <a class="reference external" href=".//getting_started-2.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-2.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-2.png" src="_images/getting_started-2.png" />
</figure>
<p>As an aside, we can extract the pixel spacing in meters from the
<code class="docutils literal notranslate"><span class="pre">.meta</span></code> attribute of the ImageIO image:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spacing</span> <span class="o">=</span> <span class="n">image0</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;Scan&#39;</span><span class="p">][</span><span class="s1">&#39;PixelHeight&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spacing_nm</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="mf">1e9</span>  <span class="c1"># nm per pixel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dim_nm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">/</span> <span class="n">spacing_nm</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
<span class="gp">... </span>          <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim_nm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim_nm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (nm)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y (nm)&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-3.png">png</a>, <a class="reference external" href=".//getting_started-3.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-3.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-3.png" src="_images/getting_started-3.png" />
</figure>
<p>This is an image of the inside of the membrane of a red blood cell. We
want to measure the network of bright regions in this image, which is
made up of a protein called <em>spectrin</em>. Our strategy will be to:</p>
<ul class="simple">
<li><p>smooth the image with Gaussian smoothing</p></li>
<li><p>threshold the image with Sauvola thresholding (Otsu thresholding also
works)</p></li>
<li><p>skeletonise the resulting binary image</p></li>
</ul>
<p>These steps can be performed by a single function in Skan,
<code class="docutils literal notranslate"><span class="pre">skan.pre.threshold</span></code>. We use parameters derived from the metadata, so
that our analysis is portable to images taken at slightly different
physical resolutions.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skan.pre</span> <span class="kn">import</span> <span class="n">threshold</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smooth_radius</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">spacing_nm</span>  <span class="c1"># float OK</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">threshold_radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">50</span> <span class="o">/</span> <span class="n">spacing_nm</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">binary0</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">(</span><span class="n">image0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">smooth_radius</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">radius</span><span class="o">=</span><span class="n">threshold_radius</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">binary0</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-4.png">png</a>, <a class="reference external" href=".//getting_started-4.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-4.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-4.png" src="_images/getting_started-4.png" />
</figure>
<p>(There are some thresholding artifacts around the left edge, due to the
dark border caused by microscope imaging drift and alignment. We will
ignore this in this document, but the Skan GUI allows for a “crop”
parameter to filter out these regions.)</p>
<p>Finally, we skeletonise this binary image:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">morphology</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skeleton0</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">skeletonize</span><span class="p">(</span><span class="n">binary0</span><span class="p">)</span>
</pre></div>
</div>
<p>Skan has functions for drawing skeletons in 2D:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skan</span> <span class="kn">import</span> <span class="n">draw</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">draw</span><span class="o">.</span><span class="n">overlay_skeleton_2d</span><span class="p">(</span><span class="n">image0</span><span class="p">,</span> <span class="n">skeleton0</span><span class="p">,</span> <span class="n">dilate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-6.png">png</a>, <a class="reference external" href=".//getting_started-6.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-6.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-6.png" src="_images/getting_started-6.png" />
</figure>
</section>
<section id="measuring-the-length-of-skeleton-branches">
<h2>1. Measuring the length of skeleton branches<a class="headerlink" href="#measuring-the-length-of-skeleton-branches" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a skeleton, we can use Skan’s primary functions:
producing a network of skeleton pixels, and measuring the properties of
branches along that network.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skan</span> <span class="kn">import</span> <span class="n">skeleton_to_csgraph</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pixel_graph</span><span class="p">,</span> <span class="n">coordinates</span> <span class="o">=</span> <span class="n">skeleton_to_csgraph</span><span class="p">(</span><span class="n">skeleton0</span><span class="p">)</span>
</pre></div>
</div>
<p>The pixel graph is a SciPy <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">CSR
matrix</a>
in which entry <span class="math notranslate nohighlight">\((i, j)\)</span> is 0 if pixels <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are
not connected, and otherwise is equal to the distance between pixels
<span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> in the skeleton. This will normally be 1 between
adjacent pixels and <span class="math notranslate nohighlight">\(\sqrt{2}\)</span> between diagonally adjacent pixels,
but in this can be scaled by a <code class="docutils literal notranslate"><span class="pre">spacing=</span></code> keyword argument that sets
the scale (and this scale can be different for each image axis). In our
case, we know the spacing between pixels, so we can measure our network
in physical units instead of pixels:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pixel_graph0</span><span class="p">,</span> <span class="n">coordinates0</span> <span class="o">=</span> <span class="n">skeleton_to_csgraph</span><span class="p">(</span><span class="n">skeleton0</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="n">spacing_nm</span><span class="p">)</span>
</pre></div>
</div>
<p>The second variable contains the coordinates (in pixel units) of the
points in the pixel graph. Finally, <code class="docutils literal notranslate"><span class="pre">degrees</span></code> is an image of the
skeleton, with each skeleton pixel containing the number of neighbouring
pixels. This enables us to distinguish between <em>junctions</em> (where three
or more skeleton branches meet), <em>endpoints</em> (where a skeleton ends),
and <em>paths</em> (pixels on the inside of a skeleton branch.</p>
<p>These intermediate objects contain all the information we need from the
skeleton, but in a more useful format. It is still difficult to
interpret, however, and the best option might be to visualise a couple
of minimal examples. Skan provides a function to do this. (Because of
the way NetworkX and Matplotlib draw networks, this method is only
recommended for very small networks.)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skan</span> <span class="kn">import</span> <span class="n">_testdata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g0</span><span class="p">,</span> <span class="n">c0</span> <span class="o">=</span> <span class="n">skeleton_to_csgraph</span><span class="p">(</span><span class="n">_testdata</span><span class="o">.</span><span class="n">skeleton0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">skeleton_to_csgraph</span><span class="p">(</span><span class="n">_testdata</span><span class="o">.</span><span class="n">skeleton1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">draw</span><span class="o">.</span><span class="n">overlay_skeleton_networkx</span><span class="p">(</span><span class="n">g0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">_testdata</span><span class="o">.</span><span class="n">skeleton0</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">axis</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">draw</span><span class="o">.</span><span class="n">overlay_skeleton_networkx</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">_testdata</span><span class="o">.</span><span class="n">skeleton1</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">axis</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">&lt;...&gt;</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-9.png">png</a>, <a class="reference external" href=".//getting_started-9.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-9.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-9.png" src="_images/getting_started-9.png" />
</figure>
<p>For more sophisticated analyses, the <code class="docutils literal notranslate"><span class="pre">skan.Skeleton</span></code> class provides a
way to keep all relevant information (the CSR matrix, the image, the
node coordinates…) together.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">skan.summarize</span></code> uses this class to trace the path from
junctions (node 3 in the left graph, 8 and 13 in the right graph) to
endpoints (1, 4, and 10 on the left, and 14 and 17 on the right) and
other junctions. It then produces a junction graph and table in the form
of a pandas DataFrame.</p>
<p>Let’s go back to the red blood cell image to illustrate this graph.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skan</span> <span class="kn">import</span> <span class="n">Skeleton</span><span class="p">,</span> <span class="n">summarize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">branch_data</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">Skeleton</span><span class="p">(</span><span class="n">skeleton0</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="n">spacing_nm</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">branch_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>skeleton-id</th>
      <th>node-id-src</th>
      <th>node-id-dst</th>
      <th>branch-distance</th>
      <th>branch-type</th>
      <th>mean-pixel-value</th>
      <th>stdev-pixel-value</th>
      <th>image-coord-src-0</th>
      <th>image-coord-src-1</th>
      <th>image-coord-dst-0</th>
      <th>image-coord-dst-1</th>
      <th>coord-src-0</th>
      <th>coord-src-1</th>
      <th>coord-dst-0</th>
      <th>coord-dst-1</th>
      <th>euclidean-distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>3</td>
      <td>265</td>
      <td>30.121296</td>
      <td>1</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>979.0</td>
      <td>8.250000</td>
      <td>960.000000</td>
      <td>0.00000</td>
      <td>1320.63184</td>
      <td>11.128920</td>
      <td>1295.001600</td>
      <td>27.942120</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>4</td>
      <td>234</td>
      <td>33.588423</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1042.0</td>
      <td>5.000000</td>
      <td>1020.000000</td>
      <td>0.00000</td>
      <td>1405.61632</td>
      <td>6.744800</td>
      <td>1375.939200</td>
      <td>30.433925</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>5</td>
      <td>52</td>
      <td>39.543020</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1446.0</td>
      <td>2.000000</td>
      <td>1420.000000</td>
      <td>0.00000</td>
      <td>1950.59616</td>
      <td>2.697920</td>
      <td>1915.523200</td>
      <td>35.176573</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>6</td>
      <td>375</td>
      <td>25.648291</td>
      <td>1</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1533.0</td>
      <td>9.666667</td>
      <td>1518.666667</td>
      <td>0.00000</td>
      <td>2067.95568</td>
      <td>13.039947</td>
      <td>2048.620587</td>
      <td>23.321365</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>8</td>
      <td>437</td>
      <td>39.891039</td>
      <td>1</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>175.0</td>
      <td>19.000000</td>
      <td>153.750000</td>
      <td>1.34896</td>
      <td>236.06800</td>
      <td>25.630240</td>
      <td>207.402600</td>
      <td>37.567083</td>
    </tr>
  </tbody>
</table>
</div><p>The branch distance is the sum of the distances along path nodes between
two nodes, in natural scale (given by <code class="docutils literal notranslate"><span class="pre">spacing</span></code>).</p>
<p>The branch type is coded by number as:</p>
<ol start="0"><li><p>endpoint-to-endpoint (isolated branch)</p>
</li><li><p>junction-to-endpoint</p>
</li><li><p>junction-to-junction</p>
</li><li><p>isolated cycle</p>
</li></ol><p>Next come the coordinates in natural space, the Euclidean distance
between the points, and the coordinates in image space (pixels).
Finally, the unique IDs of the endpoints of the branch (these correspond
to the pixel indices in the CSR representation above), and the unique ID
of the skeleton that the branch belongs to.</p>
<p>This data table follows the “tidy data” paradigm, with one row per
branch, which allows fast exploration of branch statistics. Here, for
example, we plot the distribution of branch lengths according to branch
type:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">branch_data</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;branch-distance&#39;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;branch-type&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-11.png">png</a>, <a class="reference external" href=".//getting_started-11.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-11.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-11.png" src="_images/getting_started-11.png" />
</figure>
<p>We can see that junction-to-junction branches tend to be longer than
junction-to-endpoint and junction isolated branches, and that there are
no cycles in our dataset.</p>
<p>We can also represent this visually with the
<code class="docutils literal notranslate"><span class="pre">overlay_euclidean_skeleton</span></code>, which colormaps branches according to a
user-selected attribute in the table:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">draw</span><span class="o">.</span><span class="n">overlay_euclidean_skeleton_2d</span><span class="p">(</span><span class="n">image0</span><span class="p">,</span> <span class="n">branch_data</span><span class="p">,</span>
<span class="gp">... </span>                                   <span class="n">skeleton_color_source</span><span class="o">=</span><span class="s1">&#39;branch-type&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-12.png">png</a>, <a class="reference external" href=".//getting_started-12.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-12.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-12.png" src="_images/getting_started-12.png" />
</figure>
</section>
<section id="comparing-different-skeletons">
<h2>2. Comparing different skeletons<a class="headerlink" href="#comparing-different-skeletons" title="Permalink to this headline">¶</a></h2>
<p>Now we can use Python’s data analysis tools to answer a scientific
question: do malaria-infected red blood cells differ in their spectrin
skeleton?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">iio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;fei&#39;</span><span class="p">)</span>
<span class="gp">... </span>          <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spacings</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;Scan&#39;</span><span class="p">][</span><span class="s1">&#39;PixelHeight&#39;</span><span class="p">]</span>
<span class="gp">... </span>            <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spacings_nm</span> <span class="o">=</span> <span class="mf">1e9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spacings</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">skeletonize</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">spacings_nm</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">smooth_radii</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">spacings_nm</span>  <span class="c1"># float OK</span>
<span class="gp">... </span>    <span class="n">threshold_radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">50</span> <span class="o">/</span> <span class="n">spacings_nm</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">binaries</span> <span class="o">=</span> <span class="p">(</span><span class="n">threshold</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">smooth_radius</span><span class="p">,</span>
<span class="gp">... </span>                          <span class="n">radius</span><span class="o">=</span><span class="n">threshold_radius</span><span class="p">)</span>
<span class="gp">... </span>                <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">smooth_radius</span><span class="p">,</span> <span class="n">threshold_radius</span>
<span class="gp">... </span>                <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">smooth_radii</span><span class="p">,</span> <span class="n">threshold_radii</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">skeletons</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">morphology</span><span class="o">.</span><span class="n">skeletonize</span><span class="p">,</span> <span class="n">binaries</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">skeletons</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skeletons</span> <span class="o">=</span> <span class="n">skeletonize</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">spacings_nm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">summarize</span><span class="p">(</span><span class="n">Skeleton</span><span class="p">(</span><span class="n">skeleton</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">))</span>
<span class="gp">... </span>          <span class="k">for</span> <span class="n">skeleton</span><span class="p">,</span> <span class="n">spacing</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">skeletons</span><span class="p">,</span> <span class="n">spacings_nm</span><span class="p">)]</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dataframe</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">tables</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</pre></div>
</div>
<p>This analysis is quite verbose, which is why the <code class="docutils literal notranslate"><span class="pre">skan.pipe</span></code> module
exists. It will be covered in a separate document.</p>
<p>Now, however, we have a tidy data table with information about the
sample origin of the data, allowing us to analyse the effects of
treatment on our skeleton measurement. We will use only
junction-to-junction branches.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j2j</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;branch-type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span>
<span class="gp">... </span>       <span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;branch-distance&#39;</span><span class="p">:</span>
<span class="gp">... </span>                       <span class="s1">&#39;branch distance (nm)&#39;</span><span class="p">}))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">per_image</span> <span class="o">=</span> <span class="n">j2j</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">per_image</span><span class="p">[</span><span class="s1">&#39;infected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;infected&#39;</span> <span class="k">if</span> <span class="s1">&#39;inf&#39;</span> <span class="ow">in</span> <span class="n">fn</span> <span class="k">else</span> <span class="s1">&#39;normal&#39;</span>
<span class="gp">... </span>                         <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">per_image</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">per_image</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">x</span><span class="o">=</span><span class="s1">&#39;infected&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;branch distance (nm)&#39;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;infected&#39;</span><span class="p">],</span>
<span class="gp">... </span>              <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//getting_started-14.png">png</a>, <a class="reference external" href=".//getting_started-14.hires.png">hires.png</a>, <a class="reference external" href=".//getting_started-14.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/getting_started-14.png" src="_images/getting_started-14.png" />
</figure>
<p>We now have a hint that infection by the malaria-causing parasite,
<em>Plasmodium falciparum</em>, might expand the spectrin skeleton on the inner
surface of the RBC membrane.</p>
<p>This is of course a toy example. For the full dataset and analysis, see:</p>
<ul class="simple">
<li><p>our <a class="reference external" href="https://peerj.com/articles/4312/">PeerJ paper</a> (and <a class="reference external" href="https://ilovesymposia.com/2019/05/02/why-you-should-cite-open-source-tools/">please
cite
it</a>
if you publish using skan!),</p></li>
<li><p>the <a class="reference external" href="complete_analysis.html">“Complete analysis with skan”</a> page,
and</p></li>
<li><p>the <a class="reference external" href="https://github.com/jni/skan-scripts">skan-scripts</a>
repository.</p></li>
</ul>
<p>But we hope this minimal example will serve for inspiration for your
future analysis of skeleton images.</p>
<p>If you are interested in how we used
<a class="reference external" href="https://numba.pydata.org">numba</a> to accelerate some parts of Skan,
check out <a class="reference external" href="https://www.youtube.com/watch?v=0pUPNMglnaE">Juan’s talk at the SciPy 2019
conference</a> at the the
SciPy 2019 conference.</p>
<ul class="simple">
<li><p><a class="reference download internal" href="getting_started.py">Download this page as a Python code file</a>;</p></li>
<li><p><a class="reference download internal" href="getting_started.ipynb">Download this page as a Jupyter notebook (no outputs)</a>.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installing Skan" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gui.html" class="btn btn-neutral float-right" title="Using Skan’s GUI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Juan Nunez-Iglesias &amp; skan contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>